---
title: 3:Readonly2
date: 2020/05/29
hideComments: false
---

## é¢˜ç›®

å®ç°ä¸€ä¸ªé€šç”¨ `MyReadonly2<T, K>`ï¼Œå®ƒå¸¦æœ‰ä¸¤ç§ç±»å‹çš„å‚æ•° `T` å’Œ `K`ã€‚

`K` æŒ‡å®šåº”è®¾ç½®ä¸º `Readonly` çš„ `T` çš„å±æ€§é›†ã€‚å¦‚æœæœªæä¾›` K`ï¼Œåˆ™åº”ä½¿æ‰€æœ‰å±æ€§éƒ½å˜ä¸ºåªè¯»ï¼Œå°±åƒæ™®é€šçš„ `Readonly<T>`ä¸€æ ·ã€‚

ä¾‹å¦‚ï¼š

```typescript
interface Todo {
  title: string;
  description: string;
  completed: boolean;
}

const todo: MyReadonly2<Todo, "title" | "description"> = {
  title: "Hey",
  description: "foobar",
  completed: false,
};

todo.title = "Hello"; // Error: cannot reassign a readonly property
todo.description = "barFoo"; // Error: cannot reassign a readonly property
todo.completed = true; // OK
```

<p align='left'>
  ç‚¹å‡»githubæŸ¥çœ‹ï¼š

  <a href='https://github.com/paiDaXing-web/You-Don-t-Know-TS/blob/main/vuepress/docs/challenge/2.3.Readonly2.md'>
    <img src='https://img.shields.io/badge/Github-1.8k+-143?logo=typescript&color=3178C6&logoColor=fff' />
  </a>
</p>

## æŒ‘æˆ˜

::: info æç¤º
åœ¨è¿™ä¸ªæŒ‘æˆ˜ä¸­ï¼Œä½ éœ€è¦ä¿®æ”¹ä¸‹æ–¹çš„ä»£ç ä½¿å¾—æµ‹è¯•é€šè¿‡ï¼ˆä½¿å…¶æ²¡æœ‰ç±»å‹é”™è¯¯ï¼‰ã€‚å¹¶ä¸”è®°å¾—å°†ç­”æ¡ˆåˆ†äº«å¥¥ã€‚
:::

<CodeBox surl="https://stackblitz.com/edit/typescript-wgcecz?embed=1&file=2.3.Readonly2.ts&hideExplorer=1&hideNavigation=1&theme=dark&view=editor" />

<!--info-footer-start--><br> <a href="https://github.com/paiDaXing-web/You-Don-t-Know-TS/issues/new?assignees=paiDaXing-web&labels=answer&template=2-3-%E5%AE%9E%E7%8E%B0Readonly2.md&title=2-3-%E5%AE%9E%E7%8E%B0Readonly2.md" target="_blank"><img src="https://6d78-mxm1923893223-ulteh-1302287111.tcb.qcloud.la/-%E5%88%86%E4%BA%AB%E4%BD%A0%E7%9A%84%E8%A7%A3%E7%AD%94-teal.svg?sign=8bb2a2a3bd2b1cc8f86bfd919d53197e&t=1668143704" alt="åˆ†äº«ä½ çš„è§£ç­”"/></a>  <!--info-footer-end-->

## è§£æ

è¿™ä¸ªæŒ‘æˆ˜æ˜¯ `Readonly<T>`æŒ‘æˆ˜çš„å»¶ç»­ï¼Œé™¤äº†éœ€è¦æ·»åŠ ä¸€ä¸ªæ–°çš„ç±»å‹å‚æ•° `K`ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ å°†æŒ‡å®šçš„å±æ€§è®¾ä¸ºåªè¯»å¤–ï¼Œä¸€åˆ‡éƒ½åŸºæœ¬ç›¸åŒã€‚

æˆ‘ä»¬ä»æœ€ç®€å•çš„ä¾‹å­å¼€å§‹ï¼Œå³ K æ˜¯ä¸€ä¸ªç©ºé›†åˆï¼Œå› æ­¤æ²¡æœ‰ä»»ä½•å±æ€§éœ€è¦è®¾ç½®ä¸ºåªè¯»ã€‚æˆ‘ä»¬ åªéœ€è¦è¿”å› T å°±å¥½äº†ã€‚

```javascript
type MyReadonly2<T, K> = T;
```

ç°åœ¨æˆ‘ä»¬éœ€è¦å¤„ç†è¿™æ ·ä¸€ç§æƒ…å†µï¼šå³åœ¨ K ä¸­æä¾›å¯¹åº”å±æ€§ï¼Œæˆ‘ä»¬åˆ©ç”¨&æ“ä½œç¬¦ä½¿ä¸¤ç§ç±»å‹ äº§ ç”Ÿäº¤é›†ï¼š ä¸€ä¸ªæ˜¯ä¹‹å‰æåˆ°çš„ç±»å‹ T,å¦ä¸€ä¸ªæ˜¯å«æœ‰åªè¯»å±æ€§çš„ç±»å‹ã€‚

```javascript
type MyReadonly2<T, K> = T & { readonly [P in K]: T[P] };
```

çœ‹èµ·æ¥æ˜¯ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªç¼–è¯‘é”™è¯¯ `ï¼šType P cannot be used to index type T`ã€‚è¿™æ˜¯å¯¹çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰å¯¹ K è®¾ç½®çº¦ æŸï¼Œå®ƒåº”è¯¥æ˜¯ `â€œT ä¸­çš„æ¯ä¸€ä¸ªé”®â€` :

```javascript
type MyReadonly2<T, K extends keyof T> = T & { readonly [P in K]: T[P] };
```

æ­£å¸¸å·¥ä½œå•¦? ğŸ™…â€ ä¸!

æˆ‘ä»¬è¿˜æ²¡æœ‰å¤„ç†å½“ K ä»€ä¹ˆéƒ½æ²¡æœ‰è®¾ç½®çš„æƒ…å†µï¼Œè¯¥æƒ…å†µä¸‹æˆ‘ä»¬çš„ç±»å‹å¿…é¡»å’Œé€šå¸¸ çš„ `Readonly<T>`è¡¨ç°å¾—ä¸€æ ·ã€‚ä¸ºäº†ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°† K çš„é»˜è®¤å€¼è®¾ä¸ºâ€T çš„æ‰€æœ‰é”® â€œã€‚

```javascript
// solution-1
type MyReadonly2<T, K extends keyof T = keyof T> = T & {
readonly [P in K]: T[P];
};
// å³ï¼š
type MyReadonly2<T, K extends keyof T = keyof T> = Omit<T, K> & Readonly<T>;
```

ä½ å¯èƒ½å‘ç° solution-1 åœ¨ TypeScript 4.5 åŠä»¥ä¸Šçš„ç‰ˆæœ¬ä¸­ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œå› ä¸ºåŸæœ¬çš„è¡Œ ä¸ºåœ¨ `TypeScript` ä¸­æ˜¯ä¸€ä¸ª bugï¼ˆ åœ¨ microsoft/TypeScript#45122 ä¸­ åˆ—å‡ºï¼Œ åœ¨ `microsoft/TypeScript#45263` ä¸­ è¢«ä¿®å¤ï¼Œåœ¨ TypeScript 4.5 ç‰ˆæœ¬ä¸­æ­£å¼å‘å¸ƒï¼‰ã€‚ä»æ¦‚å¿µä¸Šæ¥è¯´ï¼Œäº¤å‰ç±»å‹æ„å‘³ç€ â€œä¸â€ï¼Œ å› æ­¤{readonly a: string} & {a: string}ä¸{a: string}åº”è¯¥æ˜¯ç›¸ç­‰çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å± æ€§ a æ˜¯å¯è¯»ä¸”å¯å†™çš„ã€‚

åœ¨ TypeScript 4.5 ä¹‹å‰ï¼Œ TypeScript æœ‰ç€ç›¸åçš„ä¸æ­£ç¡®çš„è¡Œä¸ºï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨äº¤å‰ç±»å‹ä¸­ ï¼Œä¸€äº›æˆå‘˜çš„å±æ€§æ˜¯åªè¯»çš„ï¼Œä½†åœ¨å¦å¤–æˆå‘˜ä¸­åŒåå±æ€§æ˜¯å¯è¯»å¯å†™çš„ï¼Œæœ€ç»ˆå¯¹è±¡çš„ç›¸åº”å±æ€§ å´æ˜¯åªè¯»çš„ï¼Œè¿™ç§è¡Œä¸ºæ˜¯ä¸æ­£ç¡®çš„ï¼Œä½†è¿™å·²ç»è¢«ä¿®å¤äº†ã€‚å› æ­¤è¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ ä¹ˆ solution-1 ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚æƒ³è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·å†™ï¼š

```javascript
//Solution-2
type MyReadonly2<T, K extends keyof T = keyof T> = Omit<T, K> & {
readonly [P in K]: T[P];
};
//i.e.
type MyReadonly2<T, K extends keyof T = keyof T> = Omit<T, K> & Readonly<T>;
```

å› ä¸º K ä¸­çš„é”®éƒ½æ²¡æœ‰åœ¨ `keyof Omit<T, K>`ä¸­å‡ºç°è¿‡ï¼Œå› æ­¤ `solution-2` èƒ½å¤Ÿå‘ç›¸åº”å±æ€§ æ·»åŠ  `readonly` ä¿®é¥°ç¬¦ã€‚

## å‚è€ƒ

- [Conditional Types](https://www.typescriptlang.org/docs/handbook/2/conditional-types.html)
- [Mapped Types](https://www.typescriptlang.org/docs/handbook/2/mapped-types.html)
- [Index Types](https://www.typescriptlang.org/docs/handbook/2/indexed-access-types.html)
- [Key remapping in mapped types](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-1.html#key-remapping-in-mapped-types)
